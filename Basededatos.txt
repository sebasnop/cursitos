
CREATE TABLE administrador
    (nombre_usuario VARCHAR(40) PRIMARY KEY,
    clave VARCHAR(40) NOT NULL,
    nombre_completo VARCHAR(50) NOT NULL,
    correo VARCHAR(320) NOT NULL UNIQUE,
    hoja_de_vida VARCHAR(1000) NOT NULL UNIQUE
    )ENGINE = InnoDB ROW_FORMAT=DYNAMIC;

CREATE TABLE profesor
    (nombre_usuario VARCHAR(40) PRIMARY KEY,
    clave VARCHAR(40) NOT NULL,
    nombre_completo VARCHAR(50) NOT NULL,
    correo VARCHAR(320) NOT NULL UNIQUE,
    hoja_de_vida VARCHAR(1000) NOT NULL UNIQUE,
    admin_supervisor VARCHAR(40),
    FOREIGN KEY fk_admin(admin_supervisor) REFERENCES administrador(nombre_usuario)  ON DELETE CASCADE
    )ENGINE = InnoDB ROW_FORMAT=DYNAMIC ROW_FORMAT=DYNAMIC;


CREATE TABLE curso
    (codigo INT(6) PRIMARY KEY,
    nombre VARCHAR(200) NOT NULL UNIQUE,
    categoria VARCHAR(50) NOT NULL,
    descripcion VARCHAR(4000) NOT NULL,
    cantidad_estudiantes INT(4) NOT NULL CHECK (cantidad_estudiantes>=0),
    fecha_publicacion DATE NOT NULL CHECK (fecha_publicacion>= DATE '2022-01-01'),
    tipo VARCHAR(11) NOT NULL CHECK (tipo IN ('ASINCRONICO', 'SINCRONICO')),
    profesor_ensenia VARCHAR(40),
    admin_supervisa VARCHAR(40),
    FOREIGN KEY fk_profesor(profesor_ensenia) REFERENCES profesor(nombre_usuario)  ON DELETE CASCADE,
    FOREIGN KEY fk_admin(admin_supervisa) REFERENCES administrador(nombre_usuario)  ON DELETE CASCADE,

    cupos_disponibles INT(4) NOT NULL CHECK (cupos_disponibles>=0),
    fecha_fin DATE NOT NULL CHECK (fecha_fin>=fecha_publicacion),

    duracion_estimada INT(2) NOT NULL CHECK (duracion_estimada>=0)

    #CONSTRAINT chk_sub CHECK ((tipo='SINCRONICO' AND cupos_disponibles IS NOT NULL AND fecha_fin IS NOT NULL AND duracion_estimada IS NULL)
    #OR (tipo='ASINCRONICO' AND  duracion_estimada IS NOT NULL AND cupos_disponibles IS NULL AND fecha_fin IS NULL))
    )ENGINE = InnoDB ROW_FORMAT=DYNAMIC;



INSERT INTO `empresa`(`nit`, `nombre`, `direccion`, `pagina_web`) VALUES (1,'postobon','CR-1 Cl-2 ','www.postobon.com');
INSERT INTO `empresa`(`nit`, `nombre`, `direccion`, `pagina_web`) VALUES (2,'cocacola','CR-2 cl-3','www.cocacola.com');

INSERT INTO `persona`(`cedula`, `nombre`, `DIRECCION`, `telefono`) VALUES (1,'Jota Mario Valencia','Cielo','302456789');
INSERT INTO `persona`(`cedula`, `nombre`, `DIRECCION`, `telefono`) VALUES (2,'Marbelle Ramirez','Buenaventura','302356789');

INSERT INTO `factura`(`codigo`, `fecha`, `valor`, `fecha_retorno`, `tipo`, `cedula_p`) VALUES (1,DATE('2010-01-01'),500,DATE('2010-02-01'),'P',1);
INSERT INTO `factura`(`codigo`, `fecha`, `valor`, `fecha_retorno`, `tipo`, `cedula_p`) VALUES (2,DATE('2012-05-01'),500,DATE('2016-02-01'),'P',2);

INSERT INTO `factura`(`codigo`, `fecha`, `valor`, `tipo`, `nit_e`) VALUES (3,DATE('2010-01-01'),50000,'C',1);
INSERT INTO `factura`(`codigo`, `fecha`, `valor`, `tipo`, `nit_e`) VALUES (4,DATE('2012-05-01'),50000,'C',2);